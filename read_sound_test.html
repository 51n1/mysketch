<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Read Sound Test</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.14/p5.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.14/addons/p5.sound.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
      a { cursor: pointer; }
      #inputfile { display:none; }
    </style>
  </head>
<body>
<p>
  <a onclick="playSound()"><i class="fa fa-play" aria-hidden="true"></i> Play</a>
  <a onclick="stopSound()"><i class="fa fa-stop" aria-hidden="true"></i> Stop</a>
  <input type="file" accept="audio/*" id="inputfile" />
  <a onclick="$('#inputfile').click();"><i class="fa fa-file-audio-o" aria-hidden="true"></i> Select Sound</a>
</p>
<script>
// p5.js Part
var mysound, analyzer;
var defaultsound = "20170914.wav";
function setup() {
  var canvas = createCanvas(200, 200);
  background(200);
  textAlign(CENTER);
  text('select sound', width/2, height/2);
  analyzer = new p5.Amplitude();
}
function draw() {
  if(mysound) {
    var value = analyzer.getLevel();
    background(map(value, 0, 1, 0, 255));
  }
}
function initSound() {
  mysound.play();
  mysound.loop();
  analyzer.setInput(mysound);
}
function playSound() {
  if(mysound && !mysound.isPlaying()) mysound.play();
  else {
    mysound = loadSound(defaultsound, initSound);
    $('p>a:eq(2)').html('<i class="fa fa-file-audio-o" aria-hidden="true"></i> '+defaultsound);
  }
}
function stopSound() {
  if(mysound && mysound.isPlaying()) mysound.stop();
}
// When change select input file, show file name to console.log.
$("#inputfile").change(function(){
  if (this.files.length > 0) {
    // Get selected file object
    var file = this.files[0];
    $('p>a:eq(2)').html('<i class="fa fa-file-audio-o" aria-hidden="true"></i> '+file.name);
    console.log(file.name);
    // Ready of reading file
    var reader = new FileReader();
    // If success of reading file, use it as audio source.
    reader.addEventListener('load', function(e) {
      if(mysound) mysound.disconnect();
      mysound = loadSound(reader.result, initSound);
    }, true);
    // Get file data as Data URL format
    reader.readAsDataURL(file);
  }
});
</script>
</body>
</html>
