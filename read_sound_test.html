<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Read Sound Test</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.14/p5.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.14/addons/p5.sound.min.js" type="text/javascript"></script>
    <style>
    </style>
  </head>
<body>
<p><input type="file" accept="audio/*" id="inputfile" /></p>
<script>
// p5.js Part
var mysound, analyzer;
function setup() {
  var canvas = createCanvas(200, 200);
  background(200);
  textAlign(CENTER);
  text('select sound', width/2, height/2);
  analyzer = new p5.Amplitude();
}
function draw() {
  if(mysound) {
    var value = analyzer.getLevel();
    background(map(value, 0, 1, 0, 255));
  }
}
function playSound() {
  mysound.play();
  mysound.loop();
  analyzer.setInput(mysound);
}
</script>
<script>
// When change select input file, show file name to console.log.
$("#inputfile").change(function(){
  if (this.files.length > 0) {
    // Get selected file object
    var file = this.files[0];
    console.log(file.name);
    // Ready of reading file
    var reader = new FileReader();
    // If success of reading file, use it as audio source.
    reader.addEventListener('load', function(e) {
      if(mysound) mysound.disconnect();
      mysound = loadSound(reader.result, playSound);
    }, true);
    // Get file data as Data URL format
    reader.readAsDataURL(file);
  }
});
</script>
</body>
</html>
